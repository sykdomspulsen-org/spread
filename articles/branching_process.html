<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="spread">
<title>Simple Branching Process Model • spread</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simple Branching Process Model">
<meta property="og:description" content="spread">
<meta property="og:image" content="https://docs.sykdomspulsen.no/spread/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">spread</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2023.1.24</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/asymmetric_mobility_intro.html">Asymmetric Mobility Intro</a>
    <a class="dropdown-item" href="../articles/branching_process.html">Simple Branching Process Model</a>
    <a class="dropdown-item" href="../articles/commuter_model.html">Commuter Model Intro</a>
    <a class="dropdown-item" href="../articles/including_vax.html">Commuter Model With Vax Data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/sykdomspulsen-org/spread/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Simple Branching Process Model</h1>
                        <h4 data-toc-skip class="author">Gunnar Rø</h4>
            
            <h4 data-toc-skip class="date">2020-01-31</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/sykdomspulsen-org/spread/blob/HEAD/../vignettes/branching_process.Rmd" class="external-link"><code>../vignettes/branching_process.Rmd</code></a></small>
      <div class="d-none name"><code>branching_process.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>We show how to use the branching process model by modelling the potential spread of SARS-like corona virus. The branching process model takes information about the basic reproduction number, the serial interval and a dispersion parameter and can make short term forecasts of the number of new cases. The current model does not take into account depletion of suceptibles or the introduction of any control measures.</p>
<p>Following <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2760158" class="external-link">Lipsitch et Al 2003</a> we use a value for R0 of 3 and a serial interval with mean 8.4 days and SD 3.4 days. We also set the dispersion parameter to 0.16 following <a href="https://www.nature.com/articles/nature04153" class="external-link">Lloyd-Smith et Al 2005</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.repidemicsconsortium.org/epitrix" class="external-link">epitrix</a></span><span class="op">)</span>

<span class="co">#Defining the serial interval</span>

<span class="va">mu</span> <span class="op">&lt;-</span> <span class="fl">8.4</span>
<span class="va">sd</span> <span class="op">&lt;-</span> <span class="fl">3.4</span>
<span class="va">param</span> <span class="op">&lt;-</span> <span class="fu">epitrix</span><span class="fu">::</span><span class="fu"><a href="http://www.repidemicsconsortium.org/epitrix/reference/gamma_tools.html" class="external-link">gamma_mucv2shapescale</a></span><span class="op">(</span><span class="va">mu</span>, <span class="va">sd</span><span class="op">/</span><span class="va">mu</span><span class="op">)</span>
<span class="va">si</span> <span class="op">&lt;-</span>   <span class="fu">distcrete</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/distcrete/man/distcrete.html" class="external-link">distcrete</a></span><span class="op">(</span><span class="st">"gamma"</span>, interval <span class="op">=</span> <span class="fl">1</span>,
                shape <span class="op">=</span> <span class="va">param</span><span class="op">$</span><span class="va">shape</span>,
                scale <span class="op">=</span> <span class="va">param</span><span class="op">$</span><span class="va">scale</span>, w <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>


<span class="va">incidences</span> <span class="op">&lt;-</span> <span class="fu">spread</span><span class="fu">::</span><span class="fu"><a href="../reference/branching_process.html">branching_process</a></span><span class="op">(</span>initial_cases<span class="op">=</span><span class="fl">1</span>,                
                         R0<span class="op">=</span><span class="fl">1.4</span>,
                         dispersion<span class="op">=</span><span class="fl">1</span>,
                         serial_interval<span class="op">=</span><span class="va">si</span>,
                         days_simulation<span class="op">=</span><span class="fl">30</span>,
                         simulations<span class="op">=</span><span class="fl">1000</span><span class="op">)</span>
<span class="va">summary</span> <span class="op">&lt;-</span> <span class="fu">spread</span><span class="fu">::</span><span class="fu"><a href="../reference/summarize_bp.html">summarize_bp</a></span><span class="op">(</span><span class="va">incidences</span><span class="op">)</span>
<span class="fu">spread</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_quantiles_bp.html">plot_quantiles_bp</a></span><span class="op">(</span><span class="va">incidences</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Estimated daily incidence"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Days"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Incidence"</span><span class="op">)</span></code></pre></div>
<p><img src="branching_process_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">spread</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_quantiles_bp.html">plot_quantiles_bp</a></span><span class="op">(</span><span class="va">summary</span><span class="op">$</span><span class="va">cumulative</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Estimated cumulative case counts"</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Days"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"cumulative Cases"</span><span class="op">)</span></code></pre></div>
<p><img src="branching_process_files/figure-html/unnamed-chunk-1-2.png" width="672"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">incidences</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Distribution of number of cases after 30 days"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"N cases after 30 days"</span><span class="op">)</span> </code></pre></div>
<p><img src="branching_process_files/figure-html/unnamed-chunk-1-3.png" width="672"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">summary</span><span class="op">$</span><span class="va">cumulative</span><span class="op">[</span><span class="fl">30</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 5</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">summary</span><span class="op">$</span><span class="va">p_no_spread</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.242</span></code></pre></div>
<p>The median number of cases is around 50, with a probability of no spread is around 6%.</p>
</div>
<div class="section level2">
<h2 id="estimating-parameters-via-approximate-bayesian-computation-abc">Estimating parameters via approximate Bayesian computation (ABC)<a class="anchor" aria-label="anchor" href="#estimating-parameters-via-approximate-bayesian-computation-abc"></a>
</h2>
<p>We can also estimate the R0 if we know the number of cases after a time t. Here we will assume that there are between 2000 and 4000 cases after 56 days. One can also here vary the other parameters to include uncertainty in them</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fl">8.4</span>
<span class="va">sd</span> <span class="op">&lt;-</span> <span class="fl">3.4</span>
<span class="va">param</span> <span class="op">&lt;-</span> <span class="fu">epitrix</span><span class="fu">::</span><span class="fu"><a href="http://www.repidemicsconsortium.org/epitrix/reference/gamma_tools.html" class="external-link">gamma_mucv2shapescale</a></span><span class="op">(</span><span class="va">mu</span>, <span class="va">sd</span><span class="op">/</span><span class="va">mu</span><span class="op">)</span>
<span class="va">si</span> <span class="op">&lt;-</span>   <span class="fu">distcrete</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/distcrete/man/distcrete.html" class="external-link">distcrete</a></span><span class="op">(</span><span class="st">"gamma"</span>, interval <span class="op">=</span> <span class="fl">1</span>,
                shape <span class="op">=</span> <span class="va">param</span><span class="op">$</span><span class="va">shape</span>,
                scale <span class="op">=</span> <span class="va">param</span><span class="op">$</span><span class="va">scale</span>, w <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">R0</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">1</span>, to<span class="op">=</span><span class="fl">10</span>, by<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">params</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
      initial_cases<span class="op">=</span><span class="fl">1</span>,                
      R0<span class="op">=</span><span class="va">R0</span>,
      dispersion<span class="op">=</span><span class="fl">1</span>,
      serial_interval<span class="op">=</span><span class="va">si</span>,
      days_simulation<span class="op">=</span><span class="fl">56</span>
    <span class="op">)</span>
<span class="op">}</span>

<span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">spread</span><span class="fu">::</span><span class="fu"><a href="../reference/fit_params_bp.html">fit_params_bp</a></span><span class="op">(</span>
  cases_min <span class="op">=</span> <span class="fl">2000</span>,
  cases_max <span class="op">=</span> <span class="fl">3000</span>, 
  param_list <span class="op">=</span> <span class="va">params</span>, 
  simulations<span class="op">=</span><span class="fl">1000</span>
  <span class="op">)</span>
<span class="co">#&gt; Warning: UNRELIABLE VALUE: One of the 'future.apply' iterations</span>
<span class="co">#&gt; ('future_lapply-1') unexpectedly generated random numbers without declaring so.</span>
<span class="co">#&gt; There is a risk that those random numbers are not statistically sound and the</span>
<span class="co">#&gt; overall results might be invalid. To fix this, specify 'future.seed=TRUE'. This</span>
<span class="co">#&gt; ensures that proper, parallel-safe random numbers are produced via the L'Ecuyer-</span>
<span class="co">#&gt; CMRG method. To disable this check, use 'future.seed = NULL', or set option</span>
<span class="co">#&gt; 'future.rng.onMisuse' to "ignore".</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">HDInterval</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/HDInterval/man/hdi.html" class="external-link">hdi</a></span><span class="op">(</span><span class="va">r</span><span class="op">$</span><span class="va">R0</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; lower upper </span>
<span class="co">#&gt;  2.05  4.40 </span>
<span class="co">#&gt; attr(,"credMass")</span>
<span class="co">#&gt; [1] 0.95</span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Crafted by Solveig Engebretsen, Andreas Nygård Osnes, Gunnar Rø, Richard Aubrey White.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
