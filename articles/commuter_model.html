<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="spread">
<title>Commuter Model Intro • spread</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Commuter Model Intro">
<meta property="og:description" content="spread">
<meta property="og:image" content="https://docs.sykdomspulsen.no/spread/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">spread</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2023.1.24</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/asymmetric_mobility_intro.html">Asymmetric Mobility Intro</a>
    <a class="dropdown-item" href="../articles/branching_process.html">Simple Branching Process Model</a>
    <a class="dropdown-item" href="../articles/commuter_model.html">Commuter Model Intro</a>
    <a class="dropdown-item" href="../articles/including_vax.html">Commuter Model With Vax Data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/sykdomspulsen-org/spread/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Commuter Model Intro</h1>
                        <h4 data-toc-skip class="author">Richard White</h4>
            
            <h4 data-toc-skip class="date">2023-01-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/sykdomspulsen-org/spread/blob/HEAD/../vignettes/commuter_model.Rmd" class="external-link"><code>../vignettes/commuter_model.Rmd</code></a></small>
      <div class="d-none name"><code>commuter_model.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>This model is a stochastic SEIIaR (susceptible, exposed, infectious, infectious asymptomatic, recovered) metapopulation model. Each location has a local infection system, while the locations are connected by people who commute each day. The model differentiates between day and night. During the day you can infect/be infected in the location where you work, while during the night you can infect/be infected in the location where you live. It is the same commuters who travel back and forth each day. At the start of a day, all commuters are sent to their work location, where they mix for 12 hours. The commuters are then sent to their respective home locations, where they mix for 12 hours. The model is loosely based upon a published model by Engebretsen (2019).</p>
</div>
<div class="section level2">
<h2 id="data-required">Data required<a class="anchor" aria-label="anchor" href="#data-required"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></code></pre></div>
<p><code>seiiar</code> is a dataset that contains the following variables for the entire population you want to model:</p>
<ul>
<li>
<code>location_code</code> a code for each location</li>
<li>
<code>S</code> the starting value of susceptible people</li>
<li>
<code>E</code> the starting value of exposed people</li>
<li>
<code>I</code> the starting value of infectious and symptomatic people</li>
<li>
<code>Ia</code> the starting value of infectious and asymptomatic people</li>
<li>
<code>R</code> the starting value of recovered people</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># no one in Norway is infected, and everyone is susceptible</span>
<span class="fu">spread</span><span class="fu">::</span><span class="va"><a href="../reference/nor_seiiar_noinfected_2017_b2020.html">nor_seiiar_noinfected_2017_b2020</a></span>
<span class="co">#&gt;        location_code      S E I Ia R</span>
<span class="co">#&gt;   1: municip_nor0301 666759 0 0  0 0</span>
<span class="co">#&gt;   2: municip_nor1101  14899 0 0  0 0</span>
<span class="co">#&gt;   3: municip_nor1103 140856 0 0  0 0</span>
<span class="co">#&gt;   4: municip_nor1106  37166 0 0  0 0</span>
<span class="co">#&gt;   5: municip_nor1108  76742 0 0  0 0</span>
<span class="co">#&gt;  ---                                </span>
<span class="co">#&gt; 352: municip_nor5440    991 0 0  0 0</span>
<span class="co">#&gt; 353: municip_nor5441   2911 0 0  0 0</span>
<span class="co">#&gt; 354: municip_nor5442    951 0 0  0 0</span>
<span class="co">#&gt; 355: municip_nor5443   2267 0 0  0 0</span>
<span class="co">#&gt; 356: municip_nor5444  10199 0 0  0 0</span>

<span class="co"># 10 people in Oslo are infected, and everyone is susceptible</span>
<span class="fu">spread</span><span class="fu">::</span><span class="va"><a href="../reference/nor_seiiar_oslo_2017_b2020.html">nor_seiiar_oslo_2017_b2020</a></span>
<span class="co">#&gt;        location_code      S E  I Ia R</span>
<span class="co">#&gt;   1: municip_nor0301 666749 0 10  0 0</span>
<span class="co">#&gt;   2: municip_nor1101  14899 0  0  0 0</span>
<span class="co">#&gt;   3: municip_nor1103 140856 0  0  0 0</span>
<span class="co">#&gt;   4: municip_nor1106  37166 0  0  0 0</span>
<span class="co">#&gt;   5: municip_nor1108  76742 0  0  0 0</span>
<span class="co">#&gt;  ---                                 </span>
<span class="co">#&gt; 352: municip_nor5440    991 0  0  0 0</span>
<span class="co">#&gt; 353: municip_nor5441   2911 0  0  0 0</span>
<span class="co">#&gt; 354: municip_nor5442    951 0  0  0 0</span>
<span class="co">#&gt; 355: municip_nor5443   2267 0  0  0 0</span>
<span class="co">#&gt; 356: municip_nor5444  10199 0  0  0 0</span>

<span class="co"># no one in Norway is infected, and childhood vaccination data is used to</span>
<span class="co"># estimate the number of "recovered" (i.e. non-susceptible) people for measles</span>
<span class="fu">spread</span><span class="fu">::</span><span class="va"><a href="../reference/nor_seiiar_measles_noinfected_2017_b2020.html">nor_seiiar_measles_noinfected_2017_b2020</a></span>
<span class="co">#&gt;        location_code     S E I Ia      R</span>
<span class="co">#&gt;   1: municip_nor0301 59775 0 0  0 606984</span>
<span class="co">#&gt;   2: municip_nor1101  1027 0 0  0  13872</span>
<span class="co">#&gt;   3: municip_nor1103  8868 0 0  0 131988</span>
<span class="co">#&gt;   4: municip_nor1106  1557 0 0  0  35609</span>
<span class="co">#&gt;   5: municip_nor1108  3058 0 0  0  73684</span>
<span class="co">#&gt;  ---                                    </span>
<span class="co">#&gt; 352: municip_nor5440    56 0 0  0    935</span>
<span class="co">#&gt; 353: municip_nor5441   513 0 0  0   2398</span>
<span class="co">#&gt; 354: municip_nor5442    72 0 0  0    879</span>
<span class="co">#&gt; 355: municip_nor5443   150 0 0  0   2117</span>
<span class="co">#&gt; 356: municip_nor5444  1149 0 0  0   9050</span>

<span class="co"># 10 people in Oslo is infected, and childhood vaccination data is used to</span>
<span class="co"># estimate the number of "recovered" (i.e. non-susceptible) people for measles</span>
<span class="fu">spread</span><span class="fu">::</span><span class="va"><a href="../reference/nor_seiiar_measles_oslo_2017_b2020.html">nor_seiiar_measles_oslo_2017_b2020</a></span>
<span class="co">#&gt;        location_code     S E  I Ia      R</span>
<span class="co">#&gt;   1: municip_nor0301 59765 0 10  0 606984</span>
<span class="co">#&gt;   2: municip_nor1101  1027 0  0  0  13872</span>
<span class="co">#&gt;   3: municip_nor1103  8868 0  0  0 131988</span>
<span class="co">#&gt;   4: municip_nor1106  1557 0  0  0  35609</span>
<span class="co">#&gt;   5: municip_nor1108  3058 0  0  0  73684</span>
<span class="co">#&gt;  ---                                     </span>
<span class="co">#&gt; 352: municip_nor5440    56 0  0  0    935</span>
<span class="co">#&gt; 353: municip_nor5441   513 0  0  0   2398</span>
<span class="co">#&gt; 354: municip_nor5442    72 0  0  0    879</span>
<span class="co">#&gt; 355: municip_nor5443   150 0  0  0   2117</span>
<span class="co">#&gt; 356: municip_nor5444  1149 0  0  0   9050</span>

<span class="co"># we can take a closer look at Oslo</span>
<span class="fu">spread</span><span class="fu">::</span><span class="va"><a href="../reference/nor_seiiar_measles_oslo_2017_b2020.html">nor_seiiar_measles_oslo_2017_b2020</a></span><span class="op">[</span><span class="va">location_code</span><span class="op">==</span><span class="st">"municip_nor0301"</span><span class="op">]</span>
<span class="co">#&gt;      location_code     S E  I Ia      R</span>
<span class="co">#&gt; 1: municip_nor0301 59765 0 10  0 606984</span></code></pre></div>
<p><code>commuters</code> is a dataset that contains the following variables:</p>
<ul>
<li>
<code>from</code> location code for the location where the people live</li>
<li>
<code>to</code> location code for the location where the people work</li>
<li>
<code>n</code> the number of people this applies to</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># we provide the number of municipal commuters in Norway in 2017</span>
<span class="fu">spread</span><span class="fu">::</span><span class="va"><a href="../reference/nor_commuters_2017_b2020.html">nor_commuters_2017_b2020</a></span>
<span class="co">#&gt;                   from              to    n</span>
<span class="co">#&gt;     1: municip_nor0301 municip_nor1101   71</span>
<span class="co">#&gt;     2: municip_nor0301 municip_nor1103 1423</span>
<span class="co">#&gt;     3: municip_nor0301 municip_nor1106  332</span>
<span class="co">#&gt;     4: municip_nor0301 municip_nor1108  652</span>
<span class="co">#&gt;     5: municip_nor0301 municip_nor1111    5</span>
<span class="co">#&gt;    ---                                     </span>
<span class="co">#&gt; 23894: municip_nor5444 municip_nor5439    3</span>
<span class="co">#&gt; 23895: municip_nor5444 municip_nor5440    1</span>
<span class="co">#&gt; 23896: municip_nor5444 municip_nor5441   33</span>
<span class="co">#&gt; 23897: municip_nor5444 municip_nor5442   12</span>
<span class="co">#&gt; 23898: municip_nor5444 municip_nor5443    8</span></code></pre></div>
<p><code>r0</code> is the basic reproductive number.</p>
<p><code>latent_period</code> is the average number of days from when a person is exposed until they are infectious.</p>
<p><code>asymptomatic_prob</code> is the probability that an infectious person is asymptomatic.</p>
<p><code>asymptomatic_relative_infectiousness</code> is the relative infectiousness of an asymptomatic infectious person when compared to a symptomatic infectious person. This value is between 0 and 1.</p>
<p><code>days_simulation</code> the number of days you want to simulate.</p>
<p><code>N</code> this is the number of simulations that will be run and then the results will be averaged. This should generally be set to 1, unless you are performing model fitting.</p>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>We simulate one measles outbreak using the datasets <code><a href="../reference/nor_seiiar_measles_oslo_2017_b2020.html">spread::nor_seiiar_measles_oslo_2017_b2020</a></code> and <code><a href="../reference/nor_commuters_2017_b2020.html">spread::nor_commuters_2017_b2020</a></code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>
<span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">spread</span><span class="fu">::</span><span class="fu"><a href="../reference/commuter.html">commuter</a></span><span class="op">(</span>
  seiiar<span class="op">=</span><span class="fu">spread</span><span class="fu">::</span><span class="va"><a href="../reference/nor_seiiar_measles_oslo_2017_b2020.html">nor_seiiar_measles_oslo_2017_b2020</a></span>,
  commuters<span class="op">=</span><span class="fu">spread</span><span class="fu">::</span><span class="va"><a href="../reference/nor_commuters_2017_b2020.html">nor_commuters_2017_b2020</a></span>,
  r0<span class="op">=</span><span class="fl">14</span>,
  latent_period <span class="op">=</span> <span class="fl">8</span>,
  infectious_period <span class="op">=</span> <span class="fl">5</span>,
  asymptomatic_prob<span class="op">=</span><span class="fl">0</span>,
  asymptomatic_relative_infectiousness<span class="op">=</span><span class="fl">0</span>,
  days_simulation<span class="op">=</span><span class="fl">7</span><span class="op">*</span><span class="fl">9</span>,
  N<span class="op">=</span><span class="fl">1</span>
<span class="op">)</span>
<span class="co">#&gt; Starting to add edges, printing every 1000 edge</span>
<span class="co">#&gt; 1000 2000 3000 4000 5000 6000 7000 8000 9000 10000 11000 12000 13000 14000 15000 16000 17000 18000 19000 20000 21000 22000 23000 Found 23898 edges</span>
<span class="co">#&gt; Running 1 simulations of 63 days</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Finished all simulations</span></code></pre></div>
<p>Inspecting the data from Oslo:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span><span class="op">[</span><span class="va">location_code</span><span class="op">==</span><span class="st">"municip_nor0301"</span><span class="op">]</span>
<span class="co">#&gt;     sim_id   location_code week day is_6pm     S  E I Ia      R incidence</span>
<span class="co">#&gt;  1:      1 municip_nor0301    1   1   TRUE 59765  2 9  0 606985         0</span>
<span class="co">#&gt;  2:      1 municip_nor0301    1   2   TRUE 59762  4 7  0 606988         1</span>
<span class="co">#&gt;  3:      1 municip_nor0301    1   3   TRUE 59761  4 5  0 606991         1</span>
<span class="co">#&gt;  4:      1 municip_nor0301    1   4   TRUE 59760  5 4  0 606992         0</span>
<span class="co">#&gt;  5:      1 municip_nor0301    1   5   TRUE 59760  5 2  0 606994         0</span>
<span class="co">#&gt;  6:      1 municip_nor0301    1   6   TRUE 59759  5 2  0 606995         1</span>
<span class="co">#&gt;  7:      1 municip_nor0301    1   7   TRUE 59757  7 2  0 606995         0</span>
<span class="co">#&gt;  8:      1 municip_nor0301    2   8   TRUE 59756  8 2  0 606995         0</span>
<span class="co">#&gt;  9:      1 municip_nor0301    2   9   TRUE 59756  6 4  0 606995         2</span>
<span class="co">#&gt; 10:      1 municip_nor0301    2  10   TRUE 59755  6 4  0 606996         1</span>
<span class="co">#&gt; 11:      1 municip_nor0301    2  11   TRUE 59755  6 3  0 606997         0</span>
<span class="co">#&gt; 12:      1 municip_nor0301    2  12   TRUE 59755  5 3  0 606998         1</span>
<span class="co">#&gt; 13:      1 municip_nor0301    2  13   TRUE 59753  7 3  0 606998         0</span>
<span class="co">#&gt; 14:      1 municip_nor0301    2  14   TRUE 59753  6 4  0 606998         1</span>
<span class="co">#&gt; 15:      1 municip_nor0301    3  15   TRUE 59753  4 6  0 606998         2</span>
<span class="co">#&gt; 16:      1 municip_nor0301    3  16   TRUE 59750  5 8  0 606998         2</span>
<span class="co">#&gt; 17:      1 municip_nor0301    3  17   TRUE 59747  8 7  0 606999         0</span>
<span class="co">#&gt; 18:      1 municip_nor0301    3  18   TRUE 59746  6 9  0 607000         3</span>
<span class="co">#&gt; 19:      1 municip_nor0301    3  19   TRUE 59744  6 9  0 607002         2</span>
<span class="co">#&gt; 20:      1 municip_nor0301    3  20   TRUE 59744  6 7  0 607004         0</span>
<span class="co">#&gt; 21:      1 municip_nor0301    3  21   TRUE 59744  4 5  0 607008         1</span>
<span class="co">#&gt; 22:      1 municip_nor0301    4  22   TRUE 59743  5 4  0 607009         0</span>
<span class="co">#&gt; 23:      1 municip_nor0301    4  23   TRUE 59742  6 3  0 607010         0</span>
<span class="co">#&gt; 24:      1 municip_nor0301    4  24   TRUE 59740  7 4  0 607010         1</span>
<span class="co">#&gt; 25:      1 municip_nor0301    4  25   TRUE 59740  7 3  0 607011         0</span>
<span class="co">#&gt; 26:      1 municip_nor0301    4  26   TRUE 59739  6 4  0 607012         2</span>
<span class="co">#&gt; 27:      1 municip_nor0301    4  27   TRUE 59739  4 5  0 607013         2</span>
<span class="co">#&gt; 28:      1 municip_nor0301    4  28   TRUE 59738  4 5  0 607014         1</span>
<span class="co">#&gt; 29:      1 municip_nor0301    5  29   TRUE 59737  5 5  0 607014         1</span>
<span class="co">#&gt; 30:      1 municip_nor0301    5  30   TRUE 59735  4 6  0 607016         3</span>
<span class="co">#&gt; 31:      1 municip_nor0301    5  31   TRUE 59733  5 7  0 607016         1</span>
<span class="co">#&gt; 32:      1 municip_nor0301    5  32   TRUE 59733  4 7  0 607017         1</span>
<span class="co">#&gt; 33:      1 municip_nor0301    5  33   TRUE 59733  4 6  0 607018         0</span>
<span class="co">#&gt; 34:      1 municip_nor0301    5  34   TRUE 59732  5 6  0 607018         0</span>
<span class="co">#&gt; 35:      1 municip_nor0301    5  35   TRUE 59732  5 5  0 607019         0</span>
<span class="co">#&gt; 36:      1 municip_nor0301    6  36   TRUE 59730  7 4  0 607020         0</span>
<span class="co">#&gt; 37:      1 municip_nor0301    6  37   TRUE 59730  5 5  0 607021         2</span>
<span class="co">#&gt; 38:      1 municip_nor0301    6  38   TRUE 59728  6 5  0 607022         1</span>
<span class="co">#&gt; 39:      1 municip_nor0301    6  39   TRUE 59728  5 5  0 607023         1</span>
<span class="co">#&gt; 40:      1 municip_nor0301    6  40   TRUE 59726  7 4  0 607024         0</span>
<span class="co">#&gt; 41:      1 municip_nor0301    6  41   TRUE 59726  7 3  0 607025         0</span>
<span class="co">#&gt; 42:      1 municip_nor0301    6  42   TRUE 59726  7 2  0 607026         0</span>
<span class="co">#&gt; 43:      1 municip_nor0301    7  43   TRUE 59725  7 3  0 607026         0</span>
<span class="co">#&gt; 44:      1 municip_nor0301    7  44   TRUE 59723  9 3  0 607026         0</span>
<span class="co">#&gt; 45:      1 municip_nor0301    7  45   TRUE 59722 10 3  0 607026         0</span>
<span class="co">#&gt; 46:      1 municip_nor0301    7  46   TRUE 59722  9 3  0 607027         1</span>
<span class="co">#&gt; 47:      1 municip_nor0301    7  47   TRUE 59721  9 4  0 607027         1</span>
<span class="co">#&gt; 48:      1 municip_nor0301    7  48   TRUE 59721  9 3  0 607028         0</span>
<span class="co">#&gt; 49:      1 municip_nor0301    7  49   TRUE 59719 10 4  0 607028         1</span>
<span class="co">#&gt; 50:      1 municip_nor0301    8  50   TRUE 59718 11 4  0 607028         0</span>
<span class="co">#&gt; 51:      1 municip_nor0301    8  51   TRUE 59718  9 6  0 607028         2</span>
<span class="co">#&gt; 52:      1 municip_nor0301    8  52   TRUE 59717 10 5  0 607029         0</span>
<span class="co">#&gt; 53:      1 municip_nor0301    8  53   TRUE 59717  9 5  0 607030         1</span>
<span class="co">#&gt; 54:      1 municip_nor0301    8  54   TRUE 59716  7 7  0 607031         2</span>
<span class="co">#&gt; 55:      1 municip_nor0301    8  55   TRUE 59715  8 6  0 607032         0</span>
<span class="co">#&gt; 56:      1 municip_nor0301    8  56   TRUE 59713  9 5  0 607034         1</span>
<span class="co">#&gt; 57:      1 municip_nor0301    9  57   TRUE 59712 10 3  0 607036         0</span>
<span class="co">#&gt; 58:      1 municip_nor0301    9  58   TRUE 59711 10 4  0 607036         1</span>
<span class="co">#&gt; 59:      1 municip_nor0301    9  59   TRUE 59708 13 4  0 607036         0</span>
<span class="co">#&gt; 60:      1 municip_nor0301    9  60   TRUE 59707 11 6  0 607037         4</span>
<span class="co">#&gt; 61:      1 municip_nor0301    9  61   TRUE 59706 12 6  0 607037         0</span>
<span class="co">#&gt; 62:      1 municip_nor0301    9  62   TRUE 59704 14 5  0 607038         0</span>
<span class="co">#&gt; 63:      1 municip_nor0301    9  63   TRUE 59702 13 7  0 607039         3</span>
<span class="co">#&gt;     sim_id   location_code week day is_6pm     S  E I Ia      R incidence</span>
<span class="co">#&gt;        pop</span>
<span class="co">#&gt;  1: 666761</span>
<span class="co">#&gt;  2: 666761</span>
<span class="co">#&gt;  3: 666761</span>
<span class="co">#&gt;  4: 666761</span>
<span class="co">#&gt;  5: 666761</span>
<span class="co">#&gt;  6: 666761</span>
<span class="co">#&gt;  7: 666761</span>
<span class="co">#&gt;  8: 666761</span>
<span class="co">#&gt;  9: 666761</span>
<span class="co">#&gt; 10: 666761</span>
<span class="co">#&gt; 11: 666761</span>
<span class="co">#&gt; 12: 666761</span>
<span class="co">#&gt; 13: 666761</span>
<span class="co">#&gt; 14: 666761</span>
<span class="co">#&gt; 15: 666761</span>
<span class="co">#&gt; 16: 666761</span>
<span class="co">#&gt; 17: 666761</span>
<span class="co">#&gt; 18: 666761</span>
<span class="co">#&gt; 19: 666761</span>
<span class="co">#&gt; 20: 666761</span>
<span class="co">#&gt; 21: 666761</span>
<span class="co">#&gt; 22: 666761</span>
<span class="co">#&gt; 23: 666761</span>
<span class="co">#&gt; 24: 666761</span>
<span class="co">#&gt; 25: 666761</span>
<span class="co">#&gt; 26: 666761</span>
<span class="co">#&gt; 27: 666761</span>
<span class="co">#&gt; 28: 666761</span>
<span class="co">#&gt; 29: 666761</span>
<span class="co">#&gt; 30: 666761</span>
<span class="co">#&gt; 31: 666761</span>
<span class="co">#&gt; 32: 666761</span>
<span class="co">#&gt; 33: 666761</span>
<span class="co">#&gt; 34: 666761</span>
<span class="co">#&gt; 35: 666761</span>
<span class="co">#&gt; 36: 666761</span>
<span class="co">#&gt; 37: 666761</span>
<span class="co">#&gt; 38: 666761</span>
<span class="co">#&gt; 39: 666761</span>
<span class="co">#&gt; 40: 666761</span>
<span class="co">#&gt; 41: 666761</span>
<span class="co">#&gt; 42: 666761</span>
<span class="co">#&gt; 43: 666761</span>
<span class="co">#&gt; 44: 666761</span>
<span class="co">#&gt; 45: 666761</span>
<span class="co">#&gt; 46: 666761</span>
<span class="co">#&gt; 47: 666761</span>
<span class="co">#&gt; 48: 666761</span>
<span class="co">#&gt; 49: 666761</span>
<span class="co">#&gt; 50: 666761</span>
<span class="co">#&gt; 51: 666761</span>
<span class="co">#&gt; 52: 666761</span>
<span class="co">#&gt; 53: 666761</span>
<span class="co">#&gt; 54: 666761</span>
<span class="co">#&gt; 55: 666761</span>
<span class="co">#&gt; 56: 666761</span>
<span class="co">#&gt; 57: 666761</span>
<span class="co">#&gt; 58: 666761</span>
<span class="co">#&gt; 59: 666761</span>
<span class="co">#&gt; 60: 666761</span>
<span class="co">#&gt; 61: 666761</span>
<span class="co">#&gt; 62: 666761</span>
<span class="co">#&gt; 63: 666761</span>
<span class="co">#&gt;        pop</span></code></pre></div>
<p>We can merge in information about counties, and create county level data:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span><span class="op">[</span>
  <span class="fu">csdata</span><span class="fu">::</span><span class="fu"><a href="https://www.csids.no/csdata/reference/nor_locations_hierarchy_from_to.html" class="external-link">nor_locations_hierarchy_from_to</a></span><span class="op">(</span>
    from <span class="op">=</span> <span class="st">"municip"</span>, 
    to <span class="op">=</span> <span class="st">"county"</span>,
    include_to_name <span class="op">=</span> <span class="cn">TRUE</span>
    <span class="op">)</span>,
  on <span class="op">=</span> <span class="st">"location_code==from_code"</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>
    <span class="st">"county_code"</span>,
    <span class="st">"county_name"</span>
  <span class="op">)</span> <span class="op">:=</span> <span class="fu">.</span><span class="op">(</span>
    <span class="va">to_code</span>,
    <span class="va">to_name</span>
  <span class="op">)</span>
<span class="op">]</span>

<span class="va">county</span> <span class="op">&lt;-</span> <span class="va">d</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span>
  S<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span>,
  E<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">E</span><span class="op">)</span>,
  I<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span>,
  Ia<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Ia</span><span class="op">)</span>,
  R<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span>,
  incidence<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">incidence</span><span class="op">)</span>,
  pop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>
<span class="op">)</span>,
keyby<span class="op">=</span><span class="fu">.</span><span class="op">(</span><span class="va">county_code</span>,<span class="va">county_name</span>,<span class="va">week</span>,<span class="va">day</span>,<span class="va">is_6pm</span><span class="op">)</span><span class="op">]</span>
<span class="va">county</span>
<span class="co">#&gt;       county_code       county_name week day is_6pm     S E I Ia      R</span>
<span class="co">#&gt;   1: county_nor03              Oslo    1   1   TRUE 59765 2 9  0 606985</span>
<span class="co">#&gt;   2: county_nor03              Oslo    1   2   TRUE 59762 4 7  0 606988</span>
<span class="co">#&gt;   3: county_nor03              Oslo    1   3   TRUE 59761 4 5  0 606991</span>
<span class="co">#&gt;   4: county_nor03              Oslo    1   4   TRUE 59760 5 4  0 606992</span>
<span class="co">#&gt;   5: county_nor03              Oslo    1   5   TRUE 59760 5 2  0 606994</span>
<span class="co">#&gt;  ---                                                                   </span>
<span class="co">#&gt; 689: county_nor54 Troms og Finnmark    9  59   TRUE 22636 0 0  0 220397</span>
<span class="co">#&gt; 690: county_nor54 Troms og Finnmark    9  60   TRUE 22636 0 0  0 220397</span>
<span class="co">#&gt; 691: county_nor54 Troms og Finnmark    9  61   TRUE 22636 0 0  0 220397</span>
<span class="co">#&gt; 692: county_nor54 Troms og Finnmark    9  62   TRUE 22636 0 0  0 220397</span>
<span class="co">#&gt; 693: county_nor54 Troms og Finnmark    9  63   TRUE 22636 0 0  0 220397</span>
<span class="co">#&gt;      incidence    pop</span>
<span class="co">#&gt;   1:         0 666761</span>
<span class="co">#&gt;   2:         1 666761</span>
<span class="co">#&gt;   3:         1 666761</span>
<span class="co">#&gt;   4:         0 666761</span>
<span class="co">#&gt;   5:         0 666761</span>
<span class="co">#&gt;  ---                 </span>
<span class="co">#&gt; 689:         0 243033</span>
<span class="co">#&gt; 690:         0 243033</span>
<span class="co">#&gt; 691:         0 243033</span>
<span class="co">#&gt; 692:         0 243033</span>
<span class="co">#&gt; 693:         0 243033</span></code></pre></div>
<p>We can produce a daily epicurve for each county:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">county</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">day</span>, y<span class="op">=</span><span class="va">incidence</span><span class="op">)</span><span class="op">)</span>
<span class="va">q</span> <span class="op">&lt;-</span> <span class="va">q</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">q</span> <span class="op">&lt;-</span> <span class="va">q</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">county_name</span><span class="op">)</span>
<span class="va">q</span> <span class="op">&lt;-</span> <span class="va">q</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span><span class="st">"Day"</span><span class="op">)</span>
<span class="va">q</span></code></pre></div>
<p><img src="commuter_model_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>And we can produce weekly maps:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">w</span> <span class="op">&lt;-</span> <span class="va">county</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span>
  incidence_weekly <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">incidence</span><span class="op">)</span>,
  pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>
<span class="op">)</span>, keyby<span class="op">=</span><span class="fu">.</span><span class="op">(</span><span class="va">county_code</span>, <span class="va">week</span><span class="op">)</span><span class="op">]</span>

<span class="va">w</span><span class="op">[</span>,<span class="va">weekly_incidence_pr10000</span> <span class="op">:=</span> <span class="fl">10000</span><span class="op">*</span><span class="va">incidence_weekly</span><span class="op">/</span><span class="va">pop</span><span class="op">]</span>
<span class="va">w</span><span class="op">[</span>,<span class="va">facet</span><span class="op">:=</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"Week {week}"</span>,week<span class="op">=</span><span class="va">week</span><span class="op">)</span><span class="op">]</span>

<span class="va">pd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span>
  <span class="va">w</span>,
  <span class="fu">csmaps</span><span class="fu">::</span><span class="va"><a href="https://www.csids.no/csmaps/reference/nor_county_map_bxxxx_default_dt.html" class="external-link">nor_county_map_b2020_default_dt</a></span>, 
  by.x<span class="op">=</span><span class="st">"county_code"</span>,
  by.y<span class="op">=</span><span class="st">"location_code"</span>,
  allow.cartesian <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>

<span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">pd</span>, mapping<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span> x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span>
<span class="va">q</span> <span class="op">&lt;-</span> <span class="va">q</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">weekly_incidence_pr10000</span><span class="op">)</span><span class="op">)</span>
<span class="va">q</span> <span class="op">&lt;-</span> <span class="va">q</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">facet</span><span class="op">)</span>
<span class="va">q</span> <span class="op">&lt;-</span> <span class="va">q</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">q</span> <span class="op">&lt;-</span> <span class="va">q</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">coord_quickmap</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">q</span></code></pre></div>
<p><img src="commuter_model_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Crafted by Solveig Engebretsen, Andreas Nygård Osnes, Gunnar Rø, Richard Aubrey White.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
